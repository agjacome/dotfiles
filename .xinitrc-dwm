#!/bin/bash
set -euo pipefail
IFS=$'\n\t'

# source xinitrc.d scripts
for file in /etc/X11/xinit/xinitrc.d/*; do
    [ -x "$file" ] && . "$file"
done
unset file

# disable dpms
xset -dpms
xset s off

# load .Xresources
xrdb -load $HOME/.Xresources

# Java workarounds
wmname LG3D
export _JAVA_AWT_WM_NONREPARENTING=1
export _JAVA_OPTIONS='-Dawt.useSystemAAFontSettings=lcd -Dswing.aatext=true -Dsun.java2d.xrender=true'
export SWT_GTK3=0

# Gtk2 workarounds
export GTK2_RC_FILES=$HOME/.gtkrc-2.0

# set background and statusbar
$HOME/bin/wallpaper &
dwmblocks &

# start daemons
[[ -z $(pgrep -af urxvtd)    ]] && urxvtd -q -o -f
[[ -z $(pgrep -af devmon)    ]] && devmon > /dev/null 2> /dev/null &
[[ -z $(pgrep -af mpd)       ]] && mpd > /dev/null 2> /dev/null
[[ -z $(pgrep -af mpdas)     ]] && mpdas -c $HOME/.config/mpdasrc > /dev/null 2> /dev/null &

# start DWM
xscreen HDMI-0 &
dwm 2> $HOME/var/log/dwm.log
