#!/bin/bash
set -euo pipefail
IFS=$'\t\n'

declare -r file_match=${1:-.}

for revision in $(git rev-list --reverse HEAD); do
    commit=$(git log --oneline -1 $revision)
    nlines=$(
        git ls-tree -r $revision |
        grep $file_match         |
        awk '{ print $3 }'       |
        xargs git show           |
        wc -l
    )

    echo $nlines $commit
done
